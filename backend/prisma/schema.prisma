generator client {
  provider     = "prisma-client"
  output       = "../generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

model User {
  id String @id @default(uuid())

  username     String
  email        String
  passwordHash String   @map("password_hash")
  level        Int      @default(0)
  xp           Int      @default(0)
  birthDate    DateTime @default(now()) @map("birth_date")

  currentHashedRefreshToken String? @map("current_hashed_refresh_token")

  achievements UserAchievement[]
  tasksResults UserTaskResult[]

  createdAt DateTime @default(now()) @map("created_ad")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("users")
}

model Achievement {
  id String @id @default(uuid())

  title       String
  description String

  users UserAchievement[]

  createdAt DateTime @default(now()) @map("created_ad")

  @@map("achievements")
}

model UserAchievement {
  id String @id @default(uuid())

  user   User   @relation(fields: [userId], references: [id])
  userId String @map("user_id")

  achievement   Achievement @relation(fields: [achievementId], references: [id])
  achievementId String      @map("achievement_id")

  unlockedAt DateTime @default(now()) @map("unlocked_ad")

  @@unique([userId, achievementId])
  @@map("user_achievements")
}

model Task {
  id String @id @default(uuid())

  title       String
  description String
  difficulty  Difficulty @default(MEDIUM)
  xpReward    Int        @default(0) @map("xp_reward")

  createdAt DateTime @default(now()) @map("created_ad")

  results UserTaskResult[]

  @@map("tasks")
}

model UserTaskResult {
  id String @id @default(uuid())

  attemptsCount Int     @default(0) @map("attempts_count")
  isSolved      Boolean @default(false) @map("is_solved")
  timeSpent     Int     @default(0) @map("time_spent")
  xpEarned      Int     @default(0) @map("xp_earned")

  user   User   @relation(fields: [userId], references: [id])
  userId String @map("user_id")

  task   Task   @relation(fields: [taskId], references: [id])
  taskId String @map("task_id")

  createdAt DateTime @default(now()) @map("created_ad")

  @@unique([userId, taskId])
  @@map("user_task_results")
}

enum Difficulty {
  EASY
  MEDIUM
  HARD
  LEGENDARY

  @@map("difficulty_enum")
}
